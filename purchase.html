<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Purchase Product - Primal Customs</title>
  <!-- Font Awesome and Google Fonts -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
  <link href="https://fonts.googleapis.com/css2?family=Raleway:wght@300;400;600&display=swap" rel="stylesheet">
  <!-- Paystack Inline Script -->
  <script src="https://js.paystack.co/v1/inline.js"></script>
   <!-- EmailJS Library -->
  <script type="text/javascript" src="https://cdn.emailjs.com/dist/email.min.js"></script>
 
  <style>
    /* Base Styles */
    body {
      font-family: 'Raleway', sans-serif;
      margin: 0;
      padding: 0;
      background: linear-gradient(to right, #141e30, #243b55);
      color: #fff;
      overflow-x: hidden;
    }
    /* Navigation Bar */
    nav {
      position: fixed;
      top: 0;
      width: 100%;
      background: rgba(0, 0, 0, 0.8);
      padding: 15px 30px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      z-index: 1000;
    }
    nav .logo {
      font-size: 24px;
      font-weight: bold;
      color: #ff9800;
    }
    nav .nav-links {
      list-style: none;
      display: flex;
      margin: 0;
      padding: 0;
    }
    nav .nav-links li {
      margin: 0 15px;
    }
    nav .nav-links a {
      text-decoration: none;
      color: #fff;
      font-size: 18px;
      transition: 0.3s;
    }
    nav .nav-links a:hover {
      color: #ff9800;
    }
    /* Main Container */
    .container {
      max-width: 1000px;
      margin: 100px auto 50px;
      padding: 20px;
      display: flex;
      flex-wrap: wrap;
      gap: 30px;
      justify-content: center;
      animation: fadeIn 1s ease-in-out;
    }
    /* Product Info Section */
    .product-info-container {
      flex: 1 1 400px;
      background: rgba(255, 255, 255, 0.1);
      padding: 20px;
      border-radius: 10px;
      backdrop-filter: blur(10px);
      text-align: center;
    }
    .product-info-container img {
      width: 100%;
      max-height: 300px;
      object-fit: contain;
      border-radius: 10px;
      margin-bottom: 15px;
    }
    .product-info-container h2 {
      font-size: 24px;
      margin-bottom: 10px;
      color: #ff9800;
    }
    .product-info-container p {
      font-size: 16px;
      margin-bottom: 10px;
    }
    /* Purchase Form Section */
    .purchase-form-container {
      flex: 1 1 400px;
      background: rgba(255, 255, 255, 0.1);
      padding: 20px;
      border-radius: 10px;
      backdrop-filter: blur(10px);
      text-align: left;
    }
    .purchase-form-container h3 {
      text-align: center;
      font-size: 22px;
      margin-bottom: 20px;
      color: #ff9800;
    }
    .form-group {
      position: relative;
      margin-bottom: 20px;
    }
    .form-group label {
      display: block;
      margin-bottom: 5px;
      font-weight: 600;
    }
    /* --- Custom Input Field Styling & Animations --- */
    .form-group input,
    .form-group textarea,
    .form-group select {
      width: 80%;
      padding: 12px 45px 12px 50px;
      border: 1px solid #ccc;
      border-radius: 5px;
      font-size: 16px;
      background: #f2f2f2;
      transition: border 0.3s ease, box-shadow 0.3s ease, transform 0.3s ease;
      outline: none;
    }
    @keyframes pulseOnce {
      0% { transform: scale(1); }
      50% { transform: scale(1.05); }
      100% { transform: scale(1); }
    }
    .form-group input:focus,
    .form-group textarea:focus,
    .form-group select:focus {
      border-color: #ff9800;
      box-shadow: 0 0 15px rgba(255, 152, 0, 0.7);
      animation: pulseOnce 0.5s ease-in-out;
    }
    .form-group input:hover,
    .form-group textarea:hover,
    .form-group select:hover {
      border-color: #ff9800;
    }
    .form-group i {
      position: absolute;
      left: 10px;
      top: 70%;
      transform: translateY(-50%);
      color: #ff9800;
      font-size: 18px;
    }
    .terms-group {
      display: flex;
      align-items: center;
      margin-top: 15px;
    }
    .terms-group input[type="checkbox"] {
      margin-right: 10px;
      width: 18px;
      height: 18px;
    }
    .terms-group label {
      font-size: 16px;
    }
    .purchase-form-container button {
      display: block;
      width: 100%;
      padding: 12px;
      font-size: 18px;
      background: #ff9800;
      color: #000;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      transition: 0.3s;
      margin-top: 20px;
    }
    .purchase-form-container button:hover {
      background: #e68900;
    }
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }
    @media (max-width: 768px) {
      body {
        font-size: 14px;
        padding-top: 20px;
        width: 100%;
        overflow-x: hidden;
      }
      nav {
        padding: 10px 15px;
      }
      nav .nav-links {
        display: flex;
        gap: 10px;
      }
      nav .nav-links a {
        font-size: 14px;
        padding: 5px;
      }
      .container {
        width: 95%;
        max-width: 100%;
        margin: 80px auto 0;
        padding: 15px;
        min-height: calc(100vh - 80px);
        box-sizing: border-box;
      }
      .product-info-container {
        flex: 1 1 100%;
        text-align: center;
        padding: 15px;
      }
      .product-info-container img {
        max-height: 250px;
        width: 100%;
      }
      .product-info-container h2 {
        font-size: 20px;
      }
      .product-info-container p {
        font-size: 14px;
      }
      .purchase-form-container {
        flex: 1 1 100%;
        padding: 15px;
      }
      .purchase-form-container h3 {
        font-size: 18px;
      }
      .form-group {
        margin-bottom: 15px;
        position: relative;
      }
      .form-group input,
      .form-group textarea,
      .form-group select {
        width: 100%;
        max-width: 100%;
        padding: 12px 15px 12px 45px;
        font-size: 14px;
        box-sizing: border-box;
      }
      .form-group select {
        padding-left: 50px !important;
      }
      .form-group i {
        font-size: 16px;
        left: 15px;
        top: 70%;
        transform: translateY(-50%);
      }
      .terms-group label {
        font-size: 13px;
      }
      .purchase-form-container button {
        font-size: 16px;
        padding: 10px;
        width: 100%;
      }
    }
  </style>
</head>
<body>
  <!-- Navigation Bar -->
  <nav>
    <div class="navbar">
      <div class="logo">Primal Customs</div>
      <ul class="nav-links">
        <li><a href="https://jvo-james.github.io/primal-customs/homepage.html">Home</a></li>
        <li><a href="https://jvo-james.github.io/primal-customs/shop.html">Shop</a></li>
      </ul>
    </div>
  </nav>
  
  <!-- Main Container -->
  <div class="container">
    <!-- Product Info Section -->
    <div class="product-info-container">
      <img id="productImage" src="" alt="Selected Product">
      <h2 id="productTitle"></h2>
      <p id="productDescription"></p>
    </div>
    
    <!-- Purchase Form Section -->
    <div class="purchase-form-container">
      <h3>Complete Your Purchase</h3>
      <form id="purchaseForm" action="https://formsubmit.co/jamesdeledemsenu23@gmail.com" method="POST">
       <input type="hidden" name="_next" value="https://jvo-james.github.io/primal-customs/payment-success.html">
        <!--  other hidden inputs -->
        <input type="hidden" id="hiddenProductImage" name="Product Image">
        <input type="hidden" id="hiddenProductTitle" name="Product Title">
        <input type="hidden" id="hiddenProductDescription" name="Product Description">
        <!-- Full Name -->
        <div class="form-group">
          <i class="fas fa-user"></i>
          <label for="buyerName">Full Name</label>
          <input type="text" id="buyerName" name="Full Name" placeholder="Enter your full name" required>
        </div>
        <!-- Email Address -->
        <div class="form-group">
          <i class="fas fa-envelope"></i>
          <label for="buyerEmail">Email Address</label>
          <input type="email" id="buyerEmail" name="Email" placeholder="example@domain.com" required>
        </div>
        <!-- Phone Number -->
        <div class="form-group">
          <i class="fas fa-phone"></i>
          <label for="buyerPhone">Phone Number</label>
          <input type="text" id="buyerPhone" name="Phone Number" placeholder="Enter your phone number" required>
        </div>
        <!-- Shipping Address -->
        <div class="form-group">
          <i class="fas fa-map-marker-alt"></i>
          <label for="buyerAddress">Buyer's Address</label>
          <input type="text" id="buyerAddress" name="Address" placeholder="Hostel Name/ Your Address" required>
        </div>
        <!-- T-Shirt Size -->
        <div class="form-group">
          <i class="fas fa-ruler"></i>
          <label for="tshirtSize">Select Size</label>
          <select id="tshirtSize" name="Shirt Size" required>
            <option value="" disabled selected>-- Select Size --</option>
            <option value="Small">Small</option>
            <option value="Medium">Medium</option>
            <option value="Large">Large</option>
            <option value="XL">Extra Large</option>
          </select>
        </div>
        <!-- Terms & Conditions -->
        <div class="form-group terms-group">
          <input type="checkbox" id="terms" name="Terms Accepted" required>
          <label for="terms">I agree to the <a href="https://jvo-james.github.io/primal-customs/terms.html" target="_blank" style="color:#ff9800;">Terms & Conditions</a> and <a href="privacy.html" target="_blank" style="color:#ff9800;">Privacy Policy</a>.</label>
        </div>
        <!-- Proceed to Payment Button -->
        <button type="button" id="paystack-button" class="purchase-btn">
          <i class="fas fa-credit-card"></i> Proceed to Payment
        </button>
      </form>
    </div>
  </div>
  
  <!-- JavaScript: Load Product Details, Validate Form, and Handle Payment -->
  <script> 
    document.addEventListener("DOMContentLoaded", function() {
      // Load selected product details from localStorage
      const selectedProductData = localStorage.getItem("selectedProduct");
      if (selectedProductData) {
        const product = JSON.parse(selectedProductData);
        document.getElementById("productImage").src = product.image;
        document.getElementById("productTitle").innerText = product.title;
        document.getElementById("productDescription").innerText = product.description;
         // Set the hidden fields for form submission
        document.getElementById("hiddenProductImage").value = product.image;
        document.getElementById("hiddenProductTitle").value = product.title;
        document.getElementById("hiddenProductDescription").value = product.description;
      } else {
        console.log("No product data found.");
      }
    });

    // Validate all form fields
    function isFormValid() {
      const buyerName = document.getElementById("buyerName").value.trim();
      const buyerEmail = document.getElementById("buyerEmail").value.trim();
      const buyerPhone = document.getElementById("buyerPhone").value.trim();
      const buyerAddress = document.getElementById("buyerAddress").value.trim();
      const tshirtSize = document.getElementById("tshirtSize").value;
      const termsAccepted = document.getElementById("terms").checked;

      if (!buyerName || !buyerEmail || !buyerPhone || !buyerAddress || !tshirtSize || !termsAccepted) {
        return false;
      }
      return true;
    }

    // Listen for button click to initiate Paystack payment
    document.getElementById("paystack-button").addEventListener("click", function(e) {
      e.preventDefault(); // Prevent any default form submission
      if (!isFormValid()) {
        alert("Please fill in all fields and agree to the Terms & Conditions.");
        return;
      }
      payWithPaystack();
    });

    function payWithPaystack(){
      let handler = PaystackPop.setup({
        key: 'pk_live_dd07f23cf443b82c546aa66cd92a0aa3f5088ce2', // Replace with your actual Paystack public key
        email: document.getElementById("buyerEmail").value,
        amount: 1, // 80 cedis in pesewas (smallest currency unit)
        currency: "GHS",
        ref: '' + Math.floor((Math.random() * 1000000000) + 1), // Generate a unique reference number
        metadata: {
          custom_fields: [
            {
              display_name: "Buyer Name",
              variable_name: "buyer_name",
              value: document.getElementById("buyerName").value
            }
          ]
        },
        callback: function(response){
           // First, send the confirmation email
  sendConfirmationEmail();
  // Then, submit the form data
  submitFormData();
  // Optionally, you can wait a short time or chain promises before redirecting
  setTimeout(function(){
          // On successful payment, redirect to payment-successful.html
          window.location.href = "https://jvo-james.github.io/primal-customs/payment-success.html";
        }, 2000);
        }
        onClose: function(){
          // When the payment modal is closed (or cancelled) show an alert
          alert("Payment Unsuccessful, please try again.");
        }
      });
      handler.openIframe(); // Open the Paystack payment modal
    }

     // EmailJS: Send a confirmation email to the customer.
    function sendConfirmationEmail() {
      const templateParams = {
        to_name: document.getElementById("buyerName").value,
    to_email: document.getElementById("buyerEmail").value,
    buyer_phone: document.getElementById("buyerPhone").value,
    buyer_address: document.getElementById("buyerAddress").value,
    tshirt_size: document.getElementById("tshirtSize").value,
    // These values come from the hidden fields populated earlier.
    product_image: document.getElementById("hiddenProductImage").value,
    product_title: document.getElementById("hiddenProductTitle").value,
    product_description: document.getElementById("hiddenProductDescription").value,
    amount_paid: "80 cedis",  // Static value or you can calculate dynamically if needed.
    instructions: "Thank you for your purchase! To receive your order, please follow these steps:\n\n1. Check your email for shipping details.\n2. Confirm your delivery address if contacted by our support team.\n3. Track your order using the tracking number provided in subsequent emails.\n\nWe appreciate your business and are here to help if you have any questions."
   };
      emailjs.send('service_cd8p711', 'template_jm6ql4i', templateParams)
        .then(function(response) {
          console.log('Confirmation email sent successfully!', response.status, response.text);
        }, function(error) {
          console.log('Failed to send confirmation email:', error);
        });
    }

      // Submit the form data to FormSubmit using a POST request.
    function submitFormData() {
      const form = document.getElementById("purchaseForm");
      // Create a FormData object from the form.
      const formData = new FormData(form);
      // Submit to FormSubmit endpoint.
      fetch(form.action, {
        method: "POST",
        body: formData,
      })
      .then(response => {
        // After submission, redirect to payment-successful.html.
        window.location.href = "https://jvo-james.github.io/primal-customs/payment-success.html";
      })
      .catch(error => {
        console.error("Form submission error:", error);
        alert("There was an error processing your order. Please try again.");
      });
    }
  </script>
  <script>  (function(){
    emailjs.init("mRkmngSQa0dzBfRS8"); // Replace with your actual EmailJS user ID.
  })();</script>
</body>
</html>
